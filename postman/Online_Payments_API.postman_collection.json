{
	"info": {
		"_postman_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
		"name": "Online Payments API",
		"description": "Demo Postman collection for the Viva Wallet Online Payments platform.\n\n## Authentication\nAll `/api/payments` and `/api/wallets` routes require an `X-Api-Key` header.\nWebhook routes use the `:merchantKey` path parameter instead.\n\n## Setup\n1. Set the `baseUrl` variable to your server address (default: `http://localhost:3000`)\n2. Set the `apiKey` variable to your merchant API key\n3. Set the `merchantKey` variable to your merchant key for webhook routes",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:3000",
			"type": "string"
		},
		{
			"key": "apiKey",
			"value": "your-api-key-here",
			"type": "string"
		},
		{
			"key": "merchantKey",
			"value": "your-merchant-key",
			"type": "string"
		},
		{
			"key": "orderCode",
			"value": "",
			"type": "string"
		},
		{
			"key": "transactionId",
			"value": "",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "Health",
			"item": [
				{
					"name": "Root - Service Info",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/",
							"host": ["{{baseUrl}}"],
							"path": [""]
						},
						"description": "Returns service name, version, and status."
					},
					"response": []
				},
				{
					"name": "Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/health",
							"host": ["{{baseUrl}}"],
							"path": ["health"]
						},
						"description": "Simple health check endpoint."
					},
					"response": []
				}
			]
		},
		{
			"name": "Payment Orders",
			"item": [
				{
					"name": "Create Payment Order (minimal)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.orderCode) {",
									"        pm.collectionVariables.set('orderCode', jsonData.orderCode);",
									"        console.log('Saved orderCode:', jsonData.orderCode);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "X-Api-Key",
								"value": "{{apiKey}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"amount\": 1000,\n    \"customerTrns\": \"Order #12345\",\n    \"customer\": {\n        \"email\": \"customer@example.com\",\n        \"fullName\": \"John Doe\",\n        \"phone\": \"+306912345678\",\n        \"countryCode\": \"GR\",\n        \"requestLang\": \"en-GB\"\n    }\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/payments/orders",
							"host": ["{{baseUrl}}"],
							"path": ["api", "payments", "orders"]
						},
						"description": "Create a simple payment order for €10.00 (1000 cents). The `orderCode` is auto-saved for subsequent requests."
					},
					"response": []
				},
				{
					"name": "Create Payment Order (with callback)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.orderCode) {",
									"        pm.collectionVariables.set('orderCode', jsonData.orderCode);",
									"        console.log('Saved orderCode:', jsonData.orderCode);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "X-Api-Key",
								"value": "{{apiKey}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"amount\": 5000,\n    \"customerTrns\": \"Premium subscription\",\n    \"customer\": {\n        \"email\": \"customer@example.com\",\n        \"fullName\": \"Jane Smith\",\n        \"phone\": \"+306987654321\",\n        \"countryCode\": \"GR\",\n        \"requestLang\": \"en-GB\"\n    },\n    \"dynamicDescriptor\": \"MYSHOP\",\n    \"currencyCode\": \"978\",\n    \"paymentTimeout\": 3600,\n    \"sourceCode\": \"Default\",\n    \"merchantTrns\": \"REF-2025-001\",\n    \"callback\": {\n        \"successUrl\": \"https://your-backend.com/webhooks/payment-success\",\n        \"failureUrl\": \"https://your-backend.com/webhooks/payment-failure\",\n        \"webhookUrl\": \"https://your-backend.com/webhooks/all-events\",\n        \"secret\": \"your-webhook-secret\",\n        \"includeRawPayload\": true,\n        \"metadata\": {\n            \"internalOrderId\": \"abc-123\",\n            \"userId\": \"user-456\"\n        },\n        \"redirectSuccessUrl\": \"https://your-frontend.com/payment/success\",\n        \"redirectFailureUrl\": \"https://your-frontend.com/payment/failure\"\n    }\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/payments/orders",
							"host": ["{{baseUrl}}"],
							"path": ["api", "payments", "orders"]
						},
						"description": "Create a payment order for €50.00 with webhook callback configuration. Callbacks will be forwarded to your URLs when payment events occur."
					},
					"response": []
				},
				{
					"name": "Create Payment Order (pre-auth)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.orderCode) {",
									"        pm.collectionVariables.set('orderCode', jsonData.orderCode);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "X-Api-Key",
								"value": "{{apiKey}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"amount\": 2500,\n    \"customerTrns\": \"Hotel booking hold\",\n    \"preauth\": true,\n    \"customer\": {\n        \"email\": \"guest@example.com\",\n        \"fullName\": \"Alex Johnson\"\n    }\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/payments/orders",
							"host": ["{{baseUrl}}"],
							"path": ["api", "payments", "orders"]
						},
						"description": "Create a pre-authorized payment order for €25.00. The amount is held but not charged until captured via the transactions endpoint."
					},
					"response": []
				},
				{
					"name": "Create Payment Order (recurring)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.orderCode) {",
									"        pm.collectionVariables.set('orderCode', jsonData.orderCode);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "X-Api-Key",
								"value": "{{apiKey}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"amount\": 1990,\n    \"customerTrns\": \"Monthly subscription\",\n    \"allowRecurring\": true,\n    \"customer\": {\n        \"email\": \"subscriber@example.com\",\n        \"fullName\": \"Maria Garcia\"\n    },\n    \"merchantTrns\": \"SUB-MONTHLY-001\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/payments/orders",
							"host": ["{{baseUrl}}"],
							"path": ["api", "payments", "orders"]
						},
						"description": "Create a payment order for €19.90 with recurring payments enabled."
					},
					"response": []
				},
				{
					"name": "Create Card Verification",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "X-Api-Key",
								"value": "{{apiKey}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"amount\": 0,\n    \"isCardVerification\": true,\n    \"customer\": {\n        \"email\": \"verify@example.com\",\n        \"fullName\": \"Card Holder\"\n    }\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/payments/orders",
							"host": ["{{baseUrl}}"],
							"path": ["api", "payments", "orders"]
						},
						"description": "Verify a card without charging. Amount must be 0."
					},
					"response": []
				},
				{
					"name": "Get Order Details",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-Api-Key",
								"value": "{{apiKey}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/payments/orders/{{orderCode}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "payments", "orders", "{{orderCode}}"]
						},
						"description": "Retrieve details for an existing order. Uses the `orderCode` saved from a previous create request."
					},
					"response": []
				},
				{
					"name": "Update Order",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "X-Api-Key",
								"value": "{{apiKey}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"amount\": 1500,\n    \"customerTrns\": \"Updated order description\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/payments/orders/{{orderCode}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "payments", "orders", "{{orderCode}}"]
						},
						"description": "Update an existing order's amount or description."
					},
					"response": []
				},
				{
					"name": "Cancel Order",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "X-Api-Key",
								"value": "{{apiKey}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/payments/orders/{{orderCode}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "payments", "orders", "{{orderCode}}"]
						},
						"description": "Cancel an existing payment order."
					},
					"response": []
				},
				{
					"name": "Get Checkout URL",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-Api-Key",
								"value": "{{apiKey}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/payments/checkout-url/{{orderCode}}?color=0000ff&paymentMethod=",
							"host": ["{{baseUrl}}"],
							"path": ["api", "payments", "checkout-url", "{{orderCode}}"],
							"query": [
								{
									"key": "color",
									"value": "0000ff",
									"description": "Hex color for checkout page theme"
								},
								{
									"key": "paymentMethod",
									"value": "",
									"description": "Pre-select payment method",
									"disabled": true
								}
							]
						},
						"description": "Generate a checkout URL for an existing order. Open this URL in a browser to complete the payment."
					},
					"response": []
				}
			]
		},
		{
			"name": "Transactions",
			"item": [
				{
					"name": "Get Transaction Details",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-Api-Key",
								"value": "{{apiKey}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/payments/transactions/{{transactionId}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "payments", "transactions", "{{transactionId}}"]
						},
						"description": "Retrieve details for a specific transaction."
					},
					"response": []
				},
				{
					"name": "Create Transaction (Capture / Recurring)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.transaction && jsonData.transaction.transactionId) {",
									"        pm.collectionVariables.set('transactionId', jsonData.transaction.transactionId);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "X-Api-Key",
								"value": "{{apiKey}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"amount\": 1000\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/payments/transactions/{{transactionId}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "payments", "transactions", "{{transactionId}}"]
						},
						"description": "Capture a pre-authorized amount or create a recurring payment against an existing transaction."
					},
					"response": []
				},
				{
					"name": "Cancel / Refund Transaction",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "X-Api-Key",
								"value": "{{apiKey}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/payments/transactions/{{transactionId}}?amount=&sourceCode=",
							"host": ["{{baseUrl}}"],
							"path": ["api", "payments", "transactions", "{{transactionId}}"],
							"query": [
								{
									"key": "amount",
									"value": "",
									"description": "Partial refund amount in cents (omit for full refund)",
									"disabled": true
								},
								{
									"key": "sourceCode",
									"value": "",
									"description": "Payment source code",
									"disabled": true
								}
							]
						},
						"description": "Cancel or refund a transaction. Omit `amount` for a full refund, or specify a partial amount."
					},
					"response": []
				},
				{
					"name": "Fast Refund",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "X-Api-Key",
								"value": "{{apiKey}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"amount\": 500,\n    \"sourceCode\": \"Default\",\n    \"merchantTrns\": \"REFUND-001\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/payments/transactions/{{transactionId}}/refund",
							"host": ["{{baseUrl}}"],
							"path": ["api", "payments", "transactions", "{{transactionId}}", "refund"]
						},
						"description": "Process a fast refund of €5.00 for a transaction."
					},
					"response": []
				}
			]
		},
		{
			"name": "Card Tokens",
			"item": [
				{
					"name": "Create Card Token",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "X-Api-Key",
								"value": "{{apiKey}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"transactionId\": \"{{transactionId}}\",\n    \"groupId\": \"customer-group-1\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/payments/card-tokens",
							"host": ["{{baseUrl}}"],
							"path": ["api", "payments", "card-tokens"]
						},
						"description": "Create a reusable card token from a completed transaction. Use the token for future payments without re-entering card details."
					},
					"response": []
				}
			]
		},
		{
			"name": "Wallets",
			"item": [
				{
					"name": "Get All Wallets",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-Api-Key",
								"value": "{{apiKey}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/wallets",
							"host": ["{{baseUrl}}"],
							"path": ["api", "wallets"]
						},
						"description": "Retrieve all merchant wallets."
					},
					"response": []
				}
			]
		},
		{
			"name": "Webhooks",
			"item": [
				{
					"name": "Verify Webhook (Viva handshake)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/webhooks/viva/{{merchantKey}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "webhooks", "viva", "{{merchantKey}}"]
						},
						"description": "Webhook verification endpoint used by Viva Wallet during webhook URL setup. Returns the verification token."
					},
					"response": []
				},
				{
					"name": "Simulate Webhook - Success",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"orderCode\": {{orderCode}},\n    \"eventType\": \"success\",\n    \"amount\": 1000,\n    \"transactionId\": \"TEST-txn-001\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/webhooks/test-simulate",
							"host": ["{{baseUrl}}"],
							"path": ["api", "webhooks", "test-simulate"]
						},
						"description": "**Development only.** Simulate a successful payment webhook to test callback forwarding."
					},
					"response": []
				},
				{
					"name": "Simulate Webhook - Failed",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"orderCode\": {{orderCode}},\n    \"eventType\": \"failed\",\n    \"amount\": 1000\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/webhooks/test-simulate",
							"host": ["{{baseUrl}}"],
							"path": ["api", "webhooks", "test-simulate"]
						},
						"description": "**Development only.** Simulate a failed payment webhook."
					},
					"response": []
				},
				{
					"name": "Simulate Webhook - Refund",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"orderCode\": {{orderCode}},\n    \"eventType\": \"refund\",\n    \"amount\": 500\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/webhooks/test-simulate",
							"host": ["{{baseUrl}}"],
							"path": ["api", "webhooks", "test-simulate"]
						},
						"description": "**Development only.** Simulate a refund/reversal webhook."
					},
					"response": []
				},
				{
					"name": "Debug - Get Registered Callbacks",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/webhooks/callbacks/{{orderCode}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "webhooks", "callbacks", "{{orderCode}}"]
						},
						"description": "**Development only.** Check what callback URLs are registered for a specific order."
					},
					"response": []
				}
			]
		},
		{
			"name": "Payment Redirects",
			"item": [
				{
					"name": "Payment Success Redirect",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/payment/success?t={{transactionId}}&s={{orderCode}}&lang=en",
							"host": ["{{baseUrl}}"],
							"path": ["payment", "success"],
							"query": [
								{
									"key": "t",
									"value": "{{transactionId}}",
									"description": "Transaction ID"
								},
								{
									"key": "s",
									"value": "{{orderCode}}",
									"description": "Order code"
								},
								{
									"key": "lang",
									"value": "en",
									"description": "Language"
								}
							]
						},
						"description": "The redirect endpoint Viva sends the customer to after a successful payment."
					},
					"response": []
				},
				{
					"name": "Payment Failure Redirect",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/payment/failure?t={{transactionId}}&s={{orderCode}}&lang=en",
							"host": ["{{baseUrl}}"],
							"path": ["payment", "failure"],
							"query": [
								{
									"key": "t",
									"value": "{{transactionId}}",
									"description": "Transaction ID"
								},
								{
									"key": "s",
									"value": "{{orderCode}}",
									"description": "Order code"
								},
								{
									"key": "lang",
									"value": "en",
									"description": "Language"
								}
							]
						},
						"description": "The redirect endpoint Viva sends the customer to after a failed or cancelled payment."
					},
					"response": []
				}
			]
		}
	]
}